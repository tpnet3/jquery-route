jQuery.route=jQuery.route||{uri:function(a){var c=window.location.href,b=c.indexOf("#!");if(a)return setTimeout(function(){window.location.replace(c.slice(0,-1==b?c.length:b)+"#!"+a)},0),a;if(-1!=b){var d=c.slice(b+2,c.length);return d?d:"/"}return"/"},path:function(){var a=this.uri(),c=a.indexOf("?"),b=a.indexOf("#"),d=a.length;-1!=c&&-1!=b?d=c<b?c:b:-1!=c&&-1==b?d=c:-1==c&&-1!=b&&(d=b);return a.slice(0,d).replace(/\/{2,}/g,"/")},query:function(){var a=this.uri(),c=a.indexOf("?"),b=a.indexOf("#"),
d=/\+/g,e=/([^&=]+)=?([^&]*)/g,c=a.slice(c,b<a.length&&c<b?b:a.length).substring(1);for(urlParams={};a=e.exec(c);)urlParams[decodeURIComponent(a[1].replace(d," "))]=decodeURIComponent(a[2].replace(d," "));return urlParams},hash:function(){var a=this.uri(),c=a.indexOf("?"),b=a.indexOf("#");return a.slice(b+1,c<a.length&&b<c?c:a.length)},callback:[],enchantUrl:function(){var a=window.location.href,a=a.replace(/#+!+\/*|$/,"#!/"),c=a.indexOf("#!/")+3,b=a.slice(0,c),a=a.slice(c),a=a.replace(/\/{2,}/g,
"/");0<a.length&&"/"==a.slice(-1)&&(a=a.slice(0,-1));a=b+a;(b=window.location.href==a)||window.location.replace(a);return b},enchantUrlHandler:function(){jQuery.route.enchantUrl()&&setTimeout(function(){for(var a=Object.keys(jQuery.route.callback),c=0;c<a.length;c++){var b=!1;jQuery.each(jQuery.route.callback[a[c]],function(a,c){c()&&(b=!0)});if(b)break}},0)},loadedRoute:{}};
jQuery.fn.route=jQuery.fn.route||function(a,c,b){b=b||0;0==jQuery.route.callback.length&&($(document).ready(jQuery.route.enchantUrlHandler),$(window).on("hashchange",jQuery.route.enchantUrlHandler));jQuery.route.callback[b]=jQuery.route.callback[b]||[];jQuery.route.callback[b].push(function(){var b=new RegExp("^"+a.replace(/\{\*}$/,"(.+)").replace(/\{([^\/]+)}/g,"([^\\/]+)")+"$"),e=jQuery.route.path();if(b.test(e)){if("function"==typeof c){for(var f={},g=b.exec(a).slice(1),b=b.exec(e).slice(1),e=
0;e<g.length;e++)f[g[e].replace(/^\{(.+)}$/,"$1")]=b[e];c({params:f,uri:jQuery.route.uri(),path:jQuery.route.path(),query:jQuery.route.query(),hash:jQuery.route.hash()});return!0}if(!jQuery.route.loadedRoute[a])return $(document).trigger("jqueryRouteLoadStart",[c]),$.getScript(c).done(function(b,d){jQuery.route.loadedRoute[a]=!0;$(window).trigger("hashchange");$(document).trigger("jqueryRouteLoadSuccess",[c])}).fail(function(a,b,d){$(document).trigger("jqueryRouteLoadFail",[c])}),!0}return!1});return this};
